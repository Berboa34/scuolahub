{% load humanize %}
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Progetti – {{ school.name }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg:#f7f7fb;--panel:#ffffff;--ink:#1b1f24;--muted:#6b7280;--primary:#2563eb;--primary-ink:#fff;--line:#e5e7eb;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{background:var(--panel);border-bottom:1px solid var(--line);padding:16px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin-bottom:16px}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left}
    th{font-size:.9rem;color:var(--muted)}
    .status{font-size:.8rem;font-weight:600;padding:4px 8px;border-radius:999px;border:1px solid var(--line)}
    .status.active{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
    .status.draft{background:#f1f5f9;color:#334155}
    .status.closed{background:#fef2f2;color:#7f1d1d;border-color:#fecaca}
    .progress{height:10px;background:#eef2ff;border-radius:8px;overflow:hidden}
    .progress>i{display:block;height:100%;background:var(--primary)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .btn{border:1px solid var(--line);padding:8px 12px;border-radius:8px;background:#fff;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <h1>Progetti – {{ school.name }}</h1>
    <div class="muted">Totale budget: € {{ totals.budget|floatformat:0|intcomma }} —
      Spesa: € {{ totals.spent|floatformat:0|intcomma }}</div>
    <p><a href="/" style="color:var(--primary);text-decoration:none">← Torna alla dashboard</a></p>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <div class="toolbar">
      <input id="search" placeholder="Cerca progetto…" style="flex:1;padding:8px;border:1px solid var(--line);border-radius:8px;">
      <button class="btn" id="btn-reset">Azzera filtro</button>
    </div>

    <table>
      <thead>
        <tr><th>Titolo</th><th>Programma</th><th>Periodo</th><th>Budget</th><th>Speso</th><th>Avanzamento</th></tr>
      </thead>
      <tbody id="proj-body">
        {% for p in projects %}
          <tr data-title="{{ p.title|lower }}">
            <td><a href="{% url 'project_detail' p.id %}" style="text-decoration:none;color:var(--primary)">{{ p.title }}</a></td>
            <td>{{ p.get_program_display|default:p.program }}</td>
            <td>{{ p.start_date }} – {{ p.end_date }}</td>
            <td>€ {{ p.budget|floatformat:0|intcomma }}</td>
            <td>€ {{ p.spent|floatformat:0|intcomma }}</td>
            <td><div class="progress"><i style="width:{% widthratio p.spent p.budget 100 %}%"></i></div></td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="muted">Nessun progetto disponibile.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>

<script>
  const input = document.getElementById('search');
  const rows = document.querySelectorAll('#proj-body tr[data-title]');
  input.addEventListener('input',()=>{
    const q = input.value.toLowerCase();
    rows.forEach(r=>{
      r.style.display = r.dataset.title.includes(q) ? '' : 'none';
    });
  });
  document.getElementById('btn-reset').onclick=()=>{
    input.value=''; rows.forEach(r=>r.style.display='');
  };
</script>

</body>
</html>

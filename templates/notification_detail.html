{% load humanize %}
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Dettaglio notifica — ScuolaHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Stili CSS base (assunti dai tuoi file) */
    :root{
      --bg:#f3f4f6;--panel:#ffffff;--ink:#111827;--muted:#6b7280;
      --primary:#2563eb;--line:#e5e7eb;--ok:#16a34a;--bad:#dc2626;--warn:#ca8a04;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:800px;margin:0 auto;padding:16px}
    header{background:#0b2a42;color:#fff;padding:12px 0;margin-bottom:16px}
    .crumbs{font-size:13px;margin-bottom:4px}
    .card{
      background:var(--panel);
      border-radius:12px;
      border:1px solid var(--line);
      padding:16px;
      margin-top:16px;
    }
    .muted{color:var(--muted);font-size:14px}
    .badge{
      display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;
      border:1px solid var(--line);background:var(--bg);font-weight:bold;
    }
    .badge.PENDING{background:#fef9c3;border-color:#facc15;color:#854d09}
    .badge.CONFIRMED{background:#dcfce7;border-color:#4ade80;color:#16a34a}
    .badge.REJECTED{background:#fee2e2;border-color:#f87171;color:#dc2626}
    .btn-row{display:flex;gap:10px;margin-top:16px}
    .btn{
      padding:8px 16px;border-radius:6px;font-weight:600;cursor:pointer;
      border:1px solid var(--line);text-align:center;
    }
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.danger{background:var(--bad);color:#fff;border-color:var(--bad)}
    .row{display:flex;flex-direction:column;margin-bottom:12px}
  </style>
</head>
<body>

  <header>
    <div class="wrap">
      <div class="crumbs"><a href="{% url 'dashboard' %}">Dashboard</a> / Dettaglio notifica</div>
      <h2>{{ notification.message }}</h2>
    </div>
  </header>

  <main class="wrap">

    <div class="card">
      <p class="muted">
        Ricevuta il {{ notification.created_at|date:"d/m/Y" }} alle {{ notification.created_at|time:"H:i" }}.
      </p>

      {% if delegation %}
        <h3 style="margin-top:24px;">Dettagli della Delega</h3>

        <div class="card" style="padding:16px; margin-top:12px;">

            <div class="row">
                <span class="muted">Progetto:</span>
                {% if delegation.project %}
                    <a href="{% url 'project_detail' delegation.project.id %}">
                        <b>{{ delegation.project.title }}</b>
                    </a>
                {% else %}
                    <span class="muted">—</span>
                {% endif %}
            </div>

            <div class="row">
                <span class="muted">Ruolo delegato:</span>
                <b>{{ delegation.role_label|default:"(non specificato)" }}</b>
            </div>

            <div class="row">
                <span class="muted">Nota:</span>
                <p style="margin:4px 0 0 0;">{{ delegation.note|default:"(nessuna nota)" }}</p>
            </div>

            <div class="row" style="margin-top:12px;">
                <span class="muted">Stato delega:</span>
                <span class="badge {{ delegation.status }}">
                    {{ delegation.get_status_display }}
                </span>
            </div>
        </div>

        {% if can_accept or can_reject %}
          <form method="post" action="" class="btn-row">
            {% csrf_token %}
            {% if can_accept %}
              <button class="btn primary" type="submit" name="action" value="accept">
                ✅ Accetta delega
              </button>
            {% endif %}
            {% if can_reject %}
              <button class="btn danger" type="submit" name="action" value="reject"
                      onclick="return confirm('Sei sicuro di voler rifiutare questa delega?');">
                ❌ Rifiuta delega
              </button>
            {% endif %}
          </form>
        {% else %}
          <p class="muted" style="margin-top:8px;">
            Non sono disponibili ulteriori azioni su questa delega (Stato: {{ delegation.get_status_display }}).
          </p>
        {% endif %}

      {% else %}
        <p class="muted" style="margin-top:12px;">
          Questa notifica non è collegata ad alcuna delega.
        </p>
      {% endif %}

    </div>
  </main>
</body>
</html>
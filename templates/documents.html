{% load static %}
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Documenti — ScuolaHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      margin:0;
      background:#f3f4f6;
      color:#111827;
    }
    a{color:#0b5cab;text-decoration:none}
    a:hover{text-decoration:underline}
    header{background:#0b2a42;color:#fff}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .muted{color:#6b7280}
    .card{
      background:#fff;
      border-radius:10px;
      border:1px solid #e5e7eb;
      padding:16px;
      margin-top:16px;
    }
    .topnav{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px 10px;border-bottom:1px solid #e5e7eb;text-align:left;vertical-align:top}
    th{background:#f9fafb;font-weight:600}
    .badge{
      display:inline-block;
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      background:#eef2ff;
      border:1px solid #c7d2fe;
      color:#1e293b;
    }
    .badge.final{background:#dcfce7;border-color:#22c55e;color:#166534}
    .small{font-size:13px}
    .btn{
      display:inline-block;
      padding:8px 12px;
      border-radius:8px;
      border:1px solid #d1d5db;
      background:#fff;
      cursor:pointer;
      font-size:13px;
    }
    .btn.primary{background:#0b5cab;color:#fff;border-color:#0b5cab}
    .btn.danger{background:#dc2626;color:#fff;border-color:#dc2626}
    form.inline{display:inline}
    input[type="text"], select, input[type="file"]{
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #d1d5db;
      font-size:13px;
      width:100%;
      box-sizing:border-box;
    }
    .grid{display:grid;gap:12px}
    @media(min-width:800px){
      .grid.cols-2{grid-template-columns:1.3fr .7fr}
    }
    .field-label{
      font-size:12px;
      color:#6b7280;
      margin-bottom:2px;
    }
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="topnav">
      <div class="small">
        <a href="{% url 'dashboard' %}" style="color:#cfe3ff;">← Torna alla Dashboard</a>
      </div>
      <div class="small muted">
        Utente: <b>{{ request.user.username }}</b>
      </div>
    </div>
    <h1 style="margin:8px 0 0;">Documenti condivisi</h1>
    <p class="muted" style="margin:4px 0 0;font-size:14px">
      Spazio comune per i documenti di progetto. L'amministratore può marcarli come
      <b>definitivi</b> così da bloccarne la modifica dalla piattaforma.
    </p>
  </div>
</header>

<main class="wrap">
  <div class="grid cols-2">
    <!-- Lista documenti -->
    <section class="card">
      <h2 style="margin:0 0 8px 0;font-size:18px;">Elenco documenti</h2>
      {% if documents %}
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Titolo</th>
                <th>Progetto</th>
                <th>Caricato da</th>
                <th>Data</th>
                <th>Stato</th>
                <th>Azioni</th>
              </tr>
            </thead>
            <tbody>
              {% for d in documents %}
                <tr>
                  <td>
                    {% if d.file %}
                      <a href="{{ d.file.url }}" target="_blank">{{ d.title }}</a>
                    {% else %}
                      {{ d.title }}
                    {% endif %}
                  </td>
                  <td class="small">
                    {% if d.project %}
                      {{ d.project.title }}
                    {% else %}
                      —
                    {% endif %}
                  </td>
                  <td class="small">
                    {% if d.uploaded_by %}
                      {{ d.uploaded_by.username }}
                    {% else %}
                      —
                    {% endif %}
                  </td>
                  <td class="small">{{ d.uploaded_at|date:"d/m/Y H:i" }}</td>
                  <td class="small">
                    {% if d.is_final %}
                      <span class="badge final">Definitivo</span>
                    {% else %}
                      <span class="badge">Bozza</span>
                    {% endif %}
                  </td>
                  <td>
                    <form method="post"
                          action="{% url 'document_delete' d.id %}"
                          class="inline"
                          onsubmit="return confirm('Eliminare questo documento?');">
                      {% csrf_token %}
                      <button type="submit" class="btn danger">Elimina</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="muted small" style="margin-top:8px">
          Nessun documento caricato finora.
        </p>
      {% endif %}
    </section>

    <!-- Upload nuovo documento -->
    <section class="card">
      <h2 style="margin:0 0 8px 0;font-size:18px;">Carica nuovo documento</h2>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="grid" style="gap:10px">
          <div>
            <div class="field-label">Titolo</div>
            <input type="text" name="title" required placeholder="Es. Verbale consiglio di istituto">
          </div>
          <div>
            <div class="field-label">Progetto collegato (opzionale)</div>
            {% if projects %}
              <select name="project_id">
                <option value="">— Nessun progetto —</option>
                {% for p in projects %}
                  <option value="{{ p.id }}">{{ p.title }}</option>
                {% endfor %}
              </select>
            {% else %}
              <select disabled>
                <option>Nessun progetto disponibile</option>
              </select>
            {% endif %}
          </div>
          <div>
            <div class="field-label">File</div>
            <input type="file" name="file" required>
          </div>
          <div>
            <label class="small">
              <input type="checkbox" name="is_final" value="1">
              Segna come <b>definitivo</b> (non modificabile dalla piattaforma)
            </label>
          </div>
          <div>
            <button type="submit" class="btn primary">Carica documento</button>
          </div>
        </div>
      </form>
    </section>
  </div>
</main>

</body>
</html>
